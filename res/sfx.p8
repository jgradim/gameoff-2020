pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--particles demo
--by pkoch
--stolen from nerdy teachers
--adapted from lazydev academy's breakout#37 tutorial

function _init()
 _init_fxs()

 p = {x=53, y=53, r=2, c=7}
end

function _update60()
 _update_fxs()

 if btn(0) then p.x-=1 end
 if btn(1) then p.x+=1 end
 if btn(2) then p.y-=1 end
 if btn(3) then p.y+=1 end

 if btn(4) then
  fire:sched(p.x,p.y)
 end

 if btnp(5) then
  explosion:sched(p.x,p.y)
 end

 if btn(0) or btn(1) or btn(2) or btn(3) then
  trail:sched(p.x,p.y)
 end
end

function _draw()
 cls()

  _draw_fxs()

 circfill(p.x,p.y,p.r,p.c)
end
-->8
-- Particles
function class(super, cls)
 cls.meta = {__index=super}
 return setmetatable(cls, cls.meta)
end

function _init_fxs()
  particles={}
end

function _update_fxs()
 for f in all(particles) do
  f.t+=1
  if f.life <= f.t then
   del(particles, f)
  else
   f:update()
  end
 end
end

function _draw_fxs()
 for f in all(particles) do f:draw() end
end

base_sfx = {
 t=0,
 c=0,
 r=1,
 dx=0,
 dy=0,
 dr=0,
 colors={},

 sched=function(cls, ...)
  sfx(cls.sfx)

  for i=1,cls.amount do
    f = cls:gen_particle(...)
    f.t = 0
    assert(f.life, "particle must know how many frames it'll live")
    assert(f.x, "particle must know its x")
    assert(f.y, "particle must know its y")

    add(particles, setmetatable(f, {__index=cls}))
   end
 end,

 curr_color=function(f)
  return f.colors[ceil(f.t*#f.colors/f.life)]
 end,

 draw=function(f)
  circfill(f.x, f.y, f.r, f.c)
 end,

 update=function(f)
  f.x+=f.dx
  f.y+=f.dy
  f.r+=f.dr
  f.c=f:curr_color()
 end,
}

trail = class(base_sfx, {
 sfx=0,
 width=1.5,
 colors={12,13,1},
 amount=2,

 gen_particle=function(cls, x,y)
  local w = cls.width
  return {
   x=x-w/2+rnd(w),
   y=y-w/2+rnd(w),
   life=40+rnd(30),
  }
 end
})

fire =  class(base_sfx, {
 sfx = 2,
 width = 3,
 colors = {8,9,10,5},
 amount = 3,
 r = 3,
 dx=0,
 dy=-.5,
 dr=-.1,

 gen_particle=function(cls, x,y)
  local w = cls.width
  return {
   x=x-w/2+rnd(w),
   y=y-w/2+rnd(w),
   life=30+rnd(10),
  }
 end,
})

explosion =  class(base_sfx, {
 sfx = 1,
 colors={8,9,6,5},
 amount=5,
 r=5,
 dr=-0.1,

 gen_particle=function(cls, x,y)
  local w = cls.width
  return {
    x=x,
    y=y,
    life=30+rnd(15),
    dx=rnd(2)-1,
    dy=rnd(2)-1,
  }
 end,
})

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000ddd00101d00000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000dddd0d1d11100000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000d0d000000001d0000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000d100000000001d000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000d0000000000000dd00000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000ddd00000000000000010000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000d0d000000000000000001100000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000d00000000000000000001110000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000dd000000000000000000000011000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000ddd000000000000000000000010000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000dd0000000000000000000000000110000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000dd00000000000000000000000000111000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000dd000000000000000000000000000001000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000d00000000000000000000000000000000100000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000ccd000000000000000000000000000000000001100000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000c00000000000000000000000000000000000000100000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000c000000000000000000000000000000000000000111000000000000000000000000000000000000000
00000000000000000000000000000000000000000000c0c000000000000000000000000000000000000000000100000000000000000000000000000000000000
0000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000001100000000000000000000000000000000000000
000000000000000000000000000000000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000ccc000000000000000000000000000000000000000000000011100000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000ccc00000000000000000000000000000000000000000000000000101000000000000000000000000000000000
00000000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000100000000000000000000000000000000
0000000000000000000000000000000000000ccc0000000000000000000000000000000000000000000000000000000010000000000000000000000000000000
000000000000000000000000000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000007770c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000007770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000000000000000000
00000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050000000000000000000000
00000000666660000000000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666660000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000555500000000000000000000
00000000066600000000000000000666666660000050000000000000000000000000000000000000000000000000000000000000555500000000000000000000
00000000000000000000000000000666666660000555000000000000000000000000000000000000000000000000000000000000555500000000000000000000
000000000000000000000000000000666666600000500000000000000000000000000000000000000000000000000000000000005aa500000000000000000000
000000000000000000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000a0a00000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0a00000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaa00000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000999900000000000000000000
00000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000000000099900000000000000000000
00000000000000000000066666000000000000000000000000000000000000000000000000000000000000000000000000000000999000000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000000889900000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000000889900000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000008888800000000000000000000
00000000000000000000066666000000000000000000000000000000000000000000000000000000000000000000000000000009800000000000000000000000
00000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000000000088000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008077700000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000009990000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000099999000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900000000000066600000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000099999000000000000666660000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000009990000000000000666660000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000069990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000666000000099999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006666600000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000099999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006666600000099999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000666000000999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000999999999000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000099909990000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000000000000000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000000555000000000000000000000000000000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
01070000077111201108711130110872307713030120572300014027250071300725057030a7030a70006700077000a700057000370004700067000a700057000370000700007000070000700007000070000700
000300000361007220182300c64013630136300e630146300a6201562007020186200402002610030100161000010006100061000010006100061001610006100000000000000000000000000000000000000000
0002000009610076100c610046300d630076300d6200d620016200c6200b620066200a62009620096200162007610066100661005610016100161000610006100160000000000000000000000000000000000000
