pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--particles demo
--by nerdy teachers

--adapted from lazydev academy's breakout#37 tutorial

effects = {
 particles={},

 sched=function(self)
  return add(effects, self)
 end,

 update=function(self)
  print("updating effect")
 end,
}

trail = {
 sfx=0,
 width=1.5,
 colors={12,13,1},
 amount=2,
 sched=function(self, x, y)
   sfx(self.sfx)

   local w = self.width
   for i=1, self.amount do
        add_fx(
            x-w/2+rnd(w),
            y-w/2+rnd(w),
            40+rnd(30),-- die
            0,         -- dx
            0,         -- dy
            false,     -- gravity
            false,     -- grow
            false,     -- shrink
            1,         -- radius
            self.colors
        )
    end
 end,
}

fire = {
 sfx = 2,
 width = 3,
 colors = {8,9,10,5},
 amount = 3,

 sched=function(self, x, y)
    sfx(self.sfx)

    local w = self.width
    for _=1, self.amount do
        add_fx(
            x-w/2+rnd(w),
            y-w/2+rnd(w),
            30+rnd(10),
            0,         -- dx
            -.5,       -- dy
            false,     -- gravity
            false,     -- grow
            true,      -- shrink
            2,         -- radius
            self.colors
        )
    end
 end,
}

explosion = {
  sfx = 1,
  size = 5,
  colors = {8,9,6,5},
  amount = 5,

  sched=function(self, x, y)
    sfx(self.sfx)

    for i=1, self.amount do
        --settings
        add_fx(
            x,         -- x
            y,         -- y
            30+rnd(25),-- die
            rnd(2)-1,  -- dx
            rnd(2)-1,  -- dy
            false,     -- gravity
            false,     -- grow
            true,      -- shrink
            self.size,         -- radius
            self.colors    -- color_table
        )
    end
  end,
}

p = {x=53, y=53, r=2, c=7}

function _update60()
    update_fx()
    if btn(0) then p.x-=1 end
    if btn(1) then p.x+=1 end
    if btn(2) then p.y-=1 end
    if btn(3) then p.y+=1 end

    if btn(4) then
      fire:sched(p.x, p.y)
    end

    if btnp(5) then
        explosion:sched(p.x,p.y)
    end

    if btn(0) or btn(1) or btn(2) or btn(3) then
        trail:sched(p.x, p.y)
    end
end

function _draw()
    cls()

    draw_fx()

    circfill(p.x,p.y,p.r,p.c)
end

-->8
-- core particle functions

function add_fx(x,y,die,dx,dy,grav,grow,shrink,r,c_table)
    add(effects,{
        x=x,
        y=y,
        t=0,
        die=die,
        dx=dx,
        dy=dy,
        grav=grav,
        grow=grow,
        shrink=shrink,
        r=r,
        c=0,
        c_table=c_table
    })
end

function update_fx()
    for fx in all(effects) do
        --lifetime
        fx.t+=1
        if fx.t>fx.die then del(effects,fx) end

        --color depends on lifetime and num colors
        if fx.t/fx.die < 1/#fx.c_table then
            fx.c=fx.c_table[1]

        elseif fx.t/fx.die < 2/#fx.c_table then
            fx.c=fx.c_table[2]

        elseif fx.t/fx.die < 3/#fx.c_table then
            fx.c=fx.c_table[3]

        else
            fx.c=fx.c_table[4]
        end

        --physics
        if fx.grav then fx.dy+=.5 end
        if fx.grow then fx.r+=.1 end
        if fx.shrink then fx.r-=.1 end

        --move
        fx.x+=fx.dx
        fx.y+=fx.dy

    end
end

function draw_fx()
 for fx in all(effects) do
  circfill(fx.x,fx.y,fx.r,fx.c)
 end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000ddd00101d00000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000dddd0d1d11100000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000d0d000000001d0000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000d100000000001d000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000d0000000000000dd00000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000ddd00000000000000010000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000d0d000000000000000001100000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000d00000000000000000001110000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000dd000000000000000000000011000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000ddd000000000000000000000010000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000dd0000000000000000000000000110000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000dd00000000000000000000000000111000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000dd000000000000000000000000000001000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000d00000000000000000000000000000000100000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000ccd000000000000000000000000000000000001100000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000c00000000000000000000000000000000000000100000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000c000000000000000000000000000000000000000111000000000000000000000000000000000000000
00000000000000000000000000000000000000000000c0c000000000000000000000000000000000000000000100000000000000000000000000000000000000
0000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000001100000000000000000000000000000000000000
000000000000000000000000000000000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000ccc000000000000000000000000000000000000000000000011100000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000ccc00000000000000000000000000000000000000000000000000101000000000000000000000000000000000
00000000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000100000000000000000000000000000000
0000000000000000000000000000000000000ccc0000000000000000000000000000000000000000000000000000000010000000000000000000000000000000
000000000000000000000000000000000000cc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000007770c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000007770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000000000000000000
00000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050000000000000000000000
00000000666660000000000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666660000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000555500000000000000000000
00000000066600000000000000000666666660000050000000000000000000000000000000000000000000000000000000000000555500000000000000000000
00000000000000000000000000000666666660000555000000000000000000000000000000000000000000000000000000000000555500000000000000000000
000000000000000000000000000000666666600000500000000000000000000000000000000000000000000000000000000000005aa500000000000000000000
000000000000000000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000a0a00000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0a00000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaa00000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000999900000000000000000000
00000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000000000099900000000000000000000
00000000000000000000066666000000000000000000000000000000000000000000000000000000000000000000000000000000999000000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000000889900000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000000889900000000000000000000
00000000000000000000666666600000000000000000000000000000000000000000000000000000000000000000000000000008888800000000000000000000
00000000000000000000066666000000000000000000000000000000000000000000000000000000000000000000000000000009800000000000000000000000
00000000000000000000006660000000000000000000000000000000000000000000000000000000000000000000000000000000088000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008077700000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777770000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000009990000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000099999000007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900007777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000999999900000000000066600000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000099999000000000000666660000000000066600000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000009990000000000000666660000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000069990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000666000000099999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006666600000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000066666660000099999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000006666600000099999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000666000000999999999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555000000000000000009999999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000999999999000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000099909990000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000005555500000000000000000000000000000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000000555000000000000000000000000000000000000006666600000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000666000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
01070000077111201108711130110872307713030120572300014027250071300725057030a7030a70006700077000a700057000370004700067000a700057000370000700007000070000700007000070000700
000300000361007220182300c64013630136300e630146300a6201562007020186200402002610030100161000010006100061000010006100061001610006100000000000000000000000000000000000000000
0002000009610076100c610046300d630076300d6200d620016200c6200b620066200a62009620096200162007610066100661005610016100161000610006100160000000000000000000000000000000000000
